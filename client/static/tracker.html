<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äººè„¸è·Ÿè¸ª - èˆµæœºè¿½è¸ª</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #0f0f0f;
            color: #e0e0e0;
            min-height: 100vh;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 16px; }
        header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 0; border-bottom: 1px solid #333; margin-bottom: 16px;
        }
        header h1 { font-size: 1.4rem; }
        .main-content { display: grid; grid-template-columns: 1fr 300px; gap: 16px; }
        .video-panel {
            background: #1a1a1a; border-radius: 12px; overflow: hidden; position: relative;
        }
        .video-panel img {
            width: 100%; display: block; aspect-ratio: 4/3; object-fit: contain; background: #000;
        }
        .tracking-overlay {
            position: absolute; top: 8px; left: 8px;
            background: rgba(0,0,0,0.75); padding: 8px 14px; border-radius: 8px;
        }
        .tracking-target {
            font-size: 1.1rem; font-weight: 700;
        }
        .tracking-target.active { color: #ffeb3b; }
        .tracking-target.idle { color: #888; }
        .tracking-info { font-size: 0.8rem; color: #aaa; margin-top: 4px; font-family: monospace; }
        .sidebar { display: flex; flex-direction: column; gap: 12px; }
        .card {
            background: #1a1a1a; border-radius: 12px; padding: 16px;
        }
        .card h2 { font-size: 0.95rem; font-weight: 600; margin-bottom: 10px; color: #aaa; }
        .gimbal-display {
            text-align: center; padding: 12px;
            background: #252525; border-radius: 8px; margin-bottom: 10px;
        }
        .gimbal-angle { font-size: 1.8rem; font-weight: 700; color: #4caf50; font-family: monospace; }
        .gimbal-label { font-size: 0.7rem; color: #666; }
        .gimbal-row { display: flex; gap: 8px; }
        .gimbal-row > div { flex: 1; }
        .btn {
            display: block; width: 100%; padding: 10px; margin-top: 8px;
            background: #333; border: none; color: #e0e0e0; border-radius: 8px;
            cursor: pointer; font-size: 0.9rem;
        }
        .btn:hover { background: #444; }
        .face-item {
            padding: 8px 12px; background: #252525; border-radius: 8px;
            margin-bottom: 6px; display: flex; justify-content: space-between;
            border-left: 3px solid #4caf50;
        }
        .face-item.tracking { border-left-color: #ffeb3b; background: #2a2a1a; }
        .face-item.unknown { border-left-color: #f44336; }
        .priority-list { font-size: 0.85rem; color: #888; }
        .priority-list span { color: #ffeb3b; font-weight: 600; }
        @media (max-width: 768px) { .main-content { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¯ äººè„¸è·Ÿè¸ª</h1>
            <div class="priority-list">
                ä¼˜å…ˆçº§: <span>max</span> > <span>son</span> > <span>wife</span>
            </div>
        </header>
        <div class="main-content">
            <div class="video-panel">
                <img id="videoStream" src="/video_feed" alt="è§†é¢‘æµ">
                <div class="tracking-overlay">
                    <div class="tracking-target idle" id="trackingTarget">ç­‰å¾…ç›®æ ‡...</div>
                    <div class="tracking-info" id="trackingInfo"></div>
                </div>
            </div>
            <div class="sidebar">
                <div class="card">
                    <h2>ğŸ”§ èˆµæœºçŠ¶æ€</h2>
                    <div class="gimbal-row">
                        <div class="gimbal-display">
                            <div class="gimbal-angle" id="panAngle">0Â°</div>
                            <div class="gimbal-label">æ°´å¹³ (Pan)</div>
                        </div>
                        <div class="gimbal-display">
                            <div class="gimbal-angle" id="tiltAngle">0Â°</div>
                            <div class="gimbal-label">å‚ç›´ (Tilt)</div>
                        </div>
                    </div>
                    <button class="btn" onclick="gimbalCenter()">ğŸ  å›ä¸­</button>
                </div>
                <div class="card">
                    <h2>ğŸ§‘ æ£€æµ‹åˆ°çš„äººè„¸</h2>
                    <div id="faceList"></div>
                </div>
            </div>
        </div>
    </div>
    <script>
        const trackingTarget = document.getElementById('trackingTarget');
        const trackingInfo = document.getElementById('trackingInfo');
        const panAngle = document.getElementById('panAngle');
        const tiltAngle = document.getElementById('tiltAngle');
        const faceList = document.getElementById('faceList');

        async function pollStatus() {
            try {
                const r = await fetch('/api/status');
                const d = await r.json();
                if (d.tracking) {
                    trackingTarget.className = 'tracking-target active';
                    trackingTarget.textContent = `ğŸ¯ ${d.tracking}`;
                    trackingInfo.textContent = `ç½®ä¿¡åº¦: ${(d.confidence*100).toFixed(1)}%`;
                } else {
                    trackingTarget.className = 'tracking-target idle';
                    trackingTarget.textContent = 'æœç´¢ä¸­...';
                    trackingInfo.textContent = '';
                }
                panAngle.textContent = `${d.pan || 0}Â°`;
                tiltAngle.textContent = `${d.tilt || 0}Â°`;
                const faces = d.faces || [];
                if (faces.length === 0) {
                    faceList.innerHTML = '<div style="color:#555;text-align:center;padding:16px">æœªæ£€æµ‹åˆ°äººè„¸</div>';
                } else {
                    faceList.innerHTML = faces.map(f => {
                        const cls = f.name === d.tracking ? 'face-item tracking' :
                                    f.name === 'unknown' ? 'face-item unknown' : 'face-item';
                        return `<div class="${cls}">
                            <span>${f.name === d.tracking ? 'ğŸ¯ ' : ''}${f.name}</span>
                            <span style="color:#888">${(f.confidence*100).toFixed(1)}%</span>
                        </div>`;
                    }).join('');
                }
            } catch(e) {}
        }
        async function gimbalCenter() {
            await fetch('/api/gimbal/center', {method:'POST'});
        }
        setInterval(pollStatus, 800);
        pollStatus();
        document.getElementById('videoStream').onerror = function() {
            setTimeout(() => { this.src = '/video_feed?' + Date.now(); }, 2000);
        };
    </script>
</body>
</html>
